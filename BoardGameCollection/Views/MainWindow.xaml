<Window x:Class="BoardGameCollection.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BoardGameCollection.Views"
        xmlns:models="clr-namespace:BoardGameCollection.Models"
        xmlns:converters="clr-namespace:BoardGameCollection.Converters"
        mc:Ignorable="d"
        Title="Board Game Collection" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и кнопки -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <TextBlock Text="Моя коллекция настольных игр" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="20,0,0,0">
                <Button Content="Добавить игру" Command="{Binding AddGameCommand}" Width="100"/>
                <Button Content="Редактировать" Command="{Binding EditGameCommand}" Width="100"/>
                <Button Content="Удалить" Command="{Binding DeleteGameCommand}" Width="100"/>
                <Button Content="Записать сессию" Command="{Binding RecordSessionCommand}" Width="120"/>
                <Button Content="История сессий" Command="{Binding ShowSessionHistoryCommand}" Width="120"/>
                <Button Content="Обновить" Command="{Binding RefreshCommand}" Width="90"/>
                <Button Content="Сбросить фильтры" Command="{Binding ResetFiltersCommand}" Width="120"/>
            </StackPanel>
        </StackPanel>

        <!-- Панель фильтров -->
        <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="0,0,0,1" Padding="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <!-- Поиск -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Поиск" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}" 
                             ToolTip="Поиск по названию, издателю, тегам"/>
                </StackPanel>

                <!-- Основные фильтры -->
                <StackPanel Grid.Column="1" Margin="10,0,0,0">
                    <TextBlock Text="Фильтры" FontWeight="Bold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Source={x:Type models:Genre}, Converter={StaticResource EnumToCollectionConverter}}" 
                              SelectedItem="{Binding SelectedGenre}"/>
                    <ComboBox ItemsSource="{Binding Source={x:Type models:Difficulty}, Converter={StaticResource EnumToCollectionConverter}}" 
                              SelectedItem="{Binding SelectedDifficulty}"/>
                    <ComboBox ItemsSource="{Binding Source={x:Type models:GameStatus}, Converter={StaticResource EnumToCollectionConverter}}" 
                              SelectedItem="{Binding SelectedStatus}"/>
                </StackPanel>

                <!-- Фильтры по количеству игроков -->
                <StackPanel Grid.Column="2" Margin="10,0,0,0">
                    <TextBlock Text="Количество игроков" FontWeight="Bold" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBox Width="70" Text="{Binding MinPlayersFilter, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Text="-" VerticalAlignment="Center" Margin="5,0"/>
                        <TextBox Width="70" Text="{Binding MaxPlayersFilter, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Фильтры по времени игры -->
                <StackPanel Grid.Column="3" Margin="10,0,0,0">
                    <TextBlock Text="Время игры (мин)" FontWeight="Bold" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBox Width="70" Text="{Binding MinPlayTimeFilter, UpdateSourceTrigger=PropertyChanged}"/>
                        <TextBlock Text="-" VerticalAlignment="Center" Margin="5,0"/>
                        <TextBox Width="70" Text="{Binding MaxPlayTimeFilter, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основной контент -->
        <Grid Grid.Row="2" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Список игр -->
            <ListView Grid.Column="0" ItemsSource="{Binding Games}" SelectedItem="{Binding SelectedGame}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Обложка (заглушка) -->
                                <Border Grid.Column="0" Width="80" Height="110" Background="#EEE" Margin="0,0,10,0">
                                    <TextBlock Text="Обложка" VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.5"/>
                                </Border>

                                <!-- Основная информация -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding Title}" FontWeight="Bold" FontSize="16"/>
                                    <TextBlock>
                                        <Run Text="Жанр:" FontWeight="Bold"/>
                                        <Run Text="{Binding Genre, Converter={StaticResource EnumDescriptionConverter}}"/>
                                        <LineBreak/>
                                        <Run Text="Издатель:" FontWeight="Bold"/>
                                        <Run Text="{Binding Publisher}"/>
                                        <LineBreak/>
                                        <Run Text="Игроки:" FontWeight="Bold"/>
                                        <Run Text="{Binding MinPlayers}"/>
                                        <Run Text="-"/>
                                        <Run Text="{Binding MaxPlayers}"/>
                                        <Run Text="игр."/>
                                        <LineBreak/>
                                        <Run Text="Время:" FontWeight="Bold"/>
                                        <Run Text="{Binding PlayTime}"/>
                                        <Run Text="мин."/>
                                        <LineBreak/>
                                        <Run Text="Статус:" FontWeight="Bold"/>
                                        <Run Text="{Binding Status, Converter={StaticResource EnumDescriptionConverter}}"/>
                                        <LineBreak/>
                                        <Run Text="Рейтинг:" FontWeight="Bold"/>
                                        <Run Text="{Binding PersonalRating}"/>
                                        <Run Text="/10"/>
                                    </TextBlock>

                                    <!-- Теги -->
                                    <ItemsControl ItemsSource="{Binding GameTags}" Margin="0,5,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#E3F2FD" CornerRadius="3" Padding="3,1" Margin="0,2">
                                                    <TextBlock Text="{Binding Tag.Name}" FontSize="10"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Статистика -->
            <Border Grid.Column="1" BorderBrush="Gray" BorderThickness="1,0,0,0" Padding="15" Margin="15,0,0,0">
                <ScrollViewer>
                    <StackPanel>
                        <TextBlock Text="Статистика" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

                        <!-- Общая статистика -->
                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="Общая статистика" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBlock>
                                <Run Text="Всего игр:" FontWeight="Bold"/>
                                <Run Text="{Binding TotalGames}"/>
                            </TextBlock>
                            <TextBlock>
                                <Run Text="Не сыграно:" FontWeight="Bold" Foreground="Red"/>
                                <Run Text="{Binding UnplayedGamesCount}"/>
                            </TextBlock>
                        </StackPanel>

                        <!-- Статистика по статусам -->
                        <StackPanel Margin="0,0,0,15">
                            <TextBlock Text="По статусам" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ItemsControl ItemsSource="{Binding GamesByStatus}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Run Text="{Binding Status, Converter={StaticResource EnumDescriptionConverter}}" FontWeight="Bold"/>
                                            <Run Text="-"/>
                                            <Run Text="{Binding Count}"/>
                                        </TextBlock>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>

                        <!-- Рекомендации -->
                        <StackPanel>
                            <TextBlock Text="Рекомендации" FontWeight="Bold" Margin="0,0,0,5"/>
                            <Button Content="Показать рекомендации" Command="{Binding ShowRecommendationsCommand}" Width="180"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Индикатор ошибки -->
        <Grid Grid.Row="3" Margin="0,10,0,0">
            <TextBlock Text="{Binding ErrorMessage}" Foreground="Red" 
                       Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
        </Grid>
    </Grid>
</Window>